<?xml version="1.0" encoding="UTF-8"?>

<project basedir="." default="generate-classe-of" name="Assigment3_Ant">
	<description>
		Ant script for assignment3
		for the property we can have it
		or Not,since it's located in build that's first run and call
	</description>
	<target name="build-service"
		depends="generate-wadl,generated-schema,build-of-provided-class">
		<echo>Building NFFGInfo (if needed)...</echo>
		<javac destdir="${build.dir}" debug="${debug}" debuglevel="${debuglevel}"
			source="${src.dir}" target="${target}" includeantruntime="false">
			<src path="${service.src.dir}" />
			<classpath>
				<path refid="sol.classpath" />
			</classpath>
		</javac>
		<echo>Done.</echo>
	</target>
	<target name="build-client" depends="generated-schema,build-of-provided-class">
		<echo>Building NFFGInfo (if needed)...</echo>
		<javac destdir="${build.dir}" debug="${debug}" debuglevel="${debuglevel}"
			source="${src.dir}" target="${target}" includeantruntime="false">
			<src path="${client1.src.dir}" />
			<src path="${client2.src.dir}" />
			<classpath>
				<path refid="sol.classpath" />
			</classpath>
		</javac>
		<echo>Done.</echo>
	</target>

	<target name="build-of-provided-class">
		<echo>Building build-of-provided-class...</echo>
		<javac destdir="${build.dir}" debug="${debug}" debuglevel="${debuglevel}"
			source="${src.dir}" target="${target}" includeantruntime="false">
			<src path="${src.dir}" />
			<classpath>
				<path refid="sol.classpath" />
			</classpath>
		</javac>
		<echo>Done.</echo>
	</target>


	<!-- define wjc task (WADL to JAVA) -->
	<taskdef name="wjc" classname="org.jvnet.ws.wadl2java.WJCTask">
		<classpath>
			<fileset dir="${lib.dir}" includes="*.jar" />
		</classpath>
	</taskdef>

	<!-- define client artifact generation path -->
	<target name="generate-wadl">
		<mkdir dir="${gen.dir}" />
		<echo message="Compiling the descritption..." />
		<wjc target="${gen.dir}" autoSchemaPackage="false"
			package="it.polito.dp2.NFFG.sol2" description="${WADL}" />
	</target>

	<!-- Target chk-bindings -->
	<target name="-chk-bindings">
		<uptodate property="generate-bindings.notRequired"
			targetfile="${gen.dir}/.flagfile">
			<srcfiles dir="${schema.dir}" includes="**/*.xsd" />
		</uptodate>
	</target>

	<!-- Target generate-bindings-check riccardo sol -->
	<target name="generate-bindings" unless="generate-bindings.notRequired"
		depends="init,-chk-bindings" description="Generate bindings from schema">
		<exec executable="xjc" failonerror="true">
			<arg value="-d" />
			<arg value="${gen.dir}" />
			<arg value="-p" />
			<arg value="it.polito.dp2.NFFG.sol1.jaxb" />
			<arg value="${schema.dir}/nffgInfo.xsd" />
		</exec>
		<touch file="${gen.dir}/.flagfile" />
	</target>

</project>

